/**! @license Third-party licenses available at bandzoogle.com/licenses */
function d(e){let t="marquee";e.getAnimations().forEach((e=>{e.id===t&&e.cancel()}));let s=e.scrollWidth,a=e.parentNode.offsetWidth;s>a&&e.animate([{transform:"translateX(0px)"},{transform:`translateX(-${s-a}px)`}],{id:t,direction:"alternate",duration:75*(s-a),easing:"ease-in-out",iterations:1/0})}function g(){void 0===window.zoogleMedia&&(window.zoogleMedia=new u),void 0===window.zoogleMusic&&(window.zoogleMusic=new p)}import{a as v}from"/scripts/chunks/chunk-H57PQYDG.digested.js";import{a as w,c as m}from"/scripts/chunks/chunk-ED4DOYUA.digested.js";import{b as A,i as E,j as M}from"/scripts/chunks/chunk-TPOPGTYZ.digested.js";import{b as l}from"/scripts/chunks/chunk-YX7F2HNK.digested.js";import{c as b}from"/scripts/chunks/chunk-PLGRBW3W.digested.js";var L=class extends l{connect(){if(!document.querySelector("#fb-root")){let e=document.createElement("div");e.id="fb-root",document.body.appendChild(e)}if(!document.querySelector("#fb-sdk")){let e=document.createElement("script");e.id="fb-sdk",e.src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v16.0",document.body.appendChild(e)}window.FB&&window.FB.XFBML.parse()}},T=class extends l{connect(){this.element.src=`${this.element.dataset.src}&parent=${window.location.hostname}`}},k=b(v()),u=class{WRAPPER_CLASS=".zoogle-music-player";constructor(){this.players=[],this.currentPlayer=void 0,window.zoogleMedia=this,window.zoogleMedia.mediaCount=0,window.zoogleMedia.handleStats=this.handleStats,this.players.remove=e=>{this.players.splice(e,e+1)},this.setup();let e=this;document.addEventListener("pageLoad",(()=>{e.setup()})),window.$(document).on("pjax:popstate",(()=>{window.zoogleMedia.needsReset=!0}))}handleStats(e,t,s){let a=e.dataset;"false"!==a.zoogleTrack&&(typeof s>"u"&&(s={}),s={id:a.id,title:a.title,type:a.category,...s},m(document.body,"tracking:event",{type:t,params:s}))}tearDown(){document.querySelectorAll(".registered-player").forEach((e=>{e.classList.remove("registered-player")}))}resetIfNeeded(){this.needsReset&&(this.tearDown(),this.needsReset=!1)}addPlayers(){let e=document.querySelectorAll(this.WRAPPER_CLASS);for(let t=0;t<e.length;t+=1){let s=e[t];if(!s.classList.contains("registered-player")){s.classList.add("registered-player");let e=new CustomEvent("playerAdded",{detail:{player:s}});document.dispatchEvent(e)}}}setup(){this.resetIfNeeded();let e=this;typeof window.soundManager<"u"&&typeof window.SOUNDMANAGER_IS_SETUP>"u"?(window.SOUNDMANAGER_IS_SETUP=!0,window.soundManager=new k.SoundManager,window.soundManager.setup({preferFlash:!1,flashVersion:9,forceUseGlobalHTML5Audio:!0,deferSoundCreateHTML5Setup:!0,useHTML5Audio:!0,waitForWindowLoad:!0,debugMode:!1,onready(){e.isLoaded=!0,e.addPlayers();let t=new CustomEvent("soundManagerLoaded");document.dispatchEvent(t)},ontimeout(){e.isLoaded=!1,document.addEventListener("click",(e=>{(e.target.classList.contains("play")||e.target.classList.contains("play-button"))&&e.preventDefault()}))}}),window.soundManager.beginDelayedInit()):this.addPlayers()}findSoundWrapper(e){let t=e.closest("li");return t||(t=e.closest("td"),t)?t:e.parentElement}register(e){this.players.push(e)}getPlayers(){return this.players}current(){return this.currentPlayer}pause(){this.currentPlayer&&this.currentPlayer.pause()}pauseOnExit(){(!this.currentPlayer||!this.currentPlayer.classList.contains("continue-on-exit"))&&this.pause()}setActive(e){this.currentPlayer!==e&&(this.pause(),this.currentPlayer=e)}toggle(e){let t,s=this.currentTrack,a=document.querySelector("a.play.current");if(a&&(t=this.findSoundWrapper(a),a.classList.remove("current"),t.classList.remove("current")),void 0===e)return void this.pauseAllPlayers();let r=e.playable,{player:o}=e;return this.setActive(o),e.classList.add("current"),t=this.findSoundWrapper(e),t.classList.add("current"),r===s?0===s.position&&3===s.readyState?(this.pauseAllPlayers(),s.play()):s.position>=s.duration&&1!==s.readyState?s.setPosition(0):s.paused?(this.pauseAllPlayers(),s.resume()):s.pause():(this.pauseAllPlayers(),s&&s.position>0&&window.zoogleMedia.handleStats(s.parent,"Skip",{position:s.position,duration:s.duration}),s=r,s.setPosition(0),s.play()),this.currentTrack=s,!s.paused}pauseAllPlayers(){window.soundManager.pauseAll(),this.players.forEach((e=>{e.pause()}))}},p=class{LISTENER_TARGETS=["a.play","a.previous-button","a.next-button","a.play-button",".progress",".track-title a","a.toggle-info"];LISTENER_CALLBACKS=[this.onPlay,this.onPrevious,this.onNext,this.onPlayButton,this.onProgress,this.onTrackTitle,this.onToggleInfo];constructor(){for(let e=0;e<this.LISTENER_TARGETS.length;e+=1)w("click",this.LISTENER_TARGETS[e],this.LISTENER_CALLBACKS[e]);document.addEventListener("playerAdded",this.addMarquee)}onPlay(e){let t=e.target;e.preventDefault(),window.zoogleMedia&&window.zoogleMedia.isLoaded&&(t.classList.contains(".play")||(t=t.closest(".play")),window.zoogleMedia.toggle(t))}onPrevious(e){let{player:t}=e.target.closest(window.zoogleMedia.WRAPPER_CLASS),s=t.previousTrack();e.preventDefault(),window.zoogleMedia&&window.zoogleMedia.isLoaded&&window.zoogleMedia.toggle(s)}onNext(e){let{player:t}=e.target.closest(window.zoogleMedia.WRAPPER_CLASS),s=t.nextTrack();e.preventDefault(),window.zoogleMedia&&window.zoogleMedia.isLoaded&&window.zoogleMedia.toggle(s)}onPlayButton(e){if(e.preventDefault(),!window.zoogleMedia||!window.zoogleMedia.isLoaded)return;let{player:t}=e.target.closest(window.zoogleMedia.WRAPPER_CLASS),s=t.currentTrackLink(!0);s&&s.click()}onProgress(e){if(e.preventDefault(),!window.zoogleMedia||!window.zoogleMedia.isLoaded)return;let{player:t}=e.target.closest(window.zoogleMedia.WRAPPER_CLASS),s=e.offsetX||e.clientX-e.target.getBoundingClientRect().left,a=e.target.closest(".progress").offsetWidth;t.seekTo(s/a)}onTrackTitle(e){if(e.preventDefault(),!window.zoogleMedia||!window.zoogleMedia.isLoaded)return;let t=e.target.closest("li").querySelector("a.play");t&&t.click()}onToggleInfo(e){if(e.preventDefault(),!window.zoogleMedia||!window.zoogleMedia.isLoaded)return;let{player:t}=e.target.closest(window.zoogleMedia.WRAPPER_CLASS);t.toggleTrackInfo(e.target)}addMarquee(e){let t=e.detail.player.querySelector(".marquee");t&&d(t)}},h=class{NAMESPACE="zoogleMedia";constructor(e,t){if(!window.soundManager)return;this.url=e.dataset.dest,void 0===this.url&&(this.url=e.href);let s=this;window.soundManager.enabled?s.setup(e,t):document.addEventListener("soundManagerLoaded",(()=>{s.setup(e,t)}))}setup(e,t){let s=this;e.playable||(this.sound=window.soundManager.createSound({id:`playable${window.zoogleMedia.mediaCount+=1}`,url:s.url,type:"audio/mp3",whileplaying(){s.fireEvent("whileplaying")},onplay(){window.zoogleMedia.setActive(t),window.zoogleMedia.handleStats(e,"Play"),s.fireEvent("play")},onresume(){window.zoogleMedia.setActive(t),s.fireEvent("play")},onpause(){s.fireEvent("pause")},onstop(){s.fireEvent("pause"),s.sound.setPosition(0)},onfinish(){"Previews"!==s.element.dataset.category&&window.zoogleMedia.handleStats(e,"Finish"),s.fireEvent("finish")}}),this.sound.parent=e,e.playable=this.sound),this.element=e,e.player=t}fireEvent(e){let t=new CustomEvent(`${e}.${this.NAMESPACE}`,{bubbles:!0,cancelable:!0,detail:{sound:this.sound,el:this.element,type:`${e}.media`}});this.element.dispatchEvent(t)}},P=class extends l{NAMESPACE="zoogleMedia";MUSIC_FEATURE_INTERSECTION_CLASS=".track-list li:last-child";MUSIC_FEATURE_OBSERVED_CLASS="track-list-observed";PLAYLIST_OBSERVER_CONFIG={rootMargin:"100px 0px 0px 0px",threshold:0};SESSION_KEY="player";SOUND_EVENTS=["whileplaying","play","pause","finish","loadMore","soundAdded"];SOUND_EVENT_CALLBACKS=[this.onWhilePlaying,this.onPlay,this.onPause,this.onFinish,this.onLoadMore,this.onSoundAdded];connect(){g(),this.wrapper=this.element.closest(".feature"),this.wrapper?this.featureId=this.wrapper.dataset.featureId:(this.featureId=0,this.wrapper=this.element.closest(".pane")),this.wrapper||(this.wrapper=this.element.parentElement);for(let e=0;e<this.SOUND_EVENTS.length;e+=1)this.element.addEventListener(`${this.SOUND_EVENTS[e]}.${this.NAMESPACE}`,this.SOUND_EVENT_CALLBACKS[e]);let e=this.element.querySelectorAll("a.play");e.length>0&&(this.loadSounds(e),this.updateTrackDisplay(e[0],!1),this.setupDeferredPlaylist()),this.setUIState("paused"),this.element.player=this,this.element.pause=this.pause}disconnect(){for(let e=0;e<this.SOUND_EVENTS.length;e+=1)this.element.removeEventListener(`${this.SOUND_EVENTS[e]}.${this.NAMESPACE}`,this.SOUND_EVENT_CALLBACKS[e])}onWhilePlaying(e){let{player:t}=this,s=e.detail.sound,a=Math.ceil(s.position/s.durationEstimate*100);t.updateProgress(s.position,a),t.updatePosition(s)}onPlay(e){let{player:t}=this,{el:s}=e.detail;t.updateTrackDisplay(s),t.setUIState("playing")}onPause(e){let{player:t}=this,{el:s}=e.detail;t.updateTrackDisplay(s),t.setUIState("paused")}onFinish(e){let{player:t}=this,s=t.nextTrack(),a=t.currentSound();e.preventDefault(),void 0===s?(t.setUIState("paused"),t.updateProgress(0,0),a&&(a.stop(),a.setPosition(0),t.element.querySelectorAll(".current").forEach((e=>{e.classList.remove("current")}))),s=t.element.querySelector("a.play:first-child"),t.updateTrackDisplay(s,!1),t.element.classList.remove("playing")):window.zoogleMedia.toggle(s)}onLoadMore(){let{player:e}=this;e.loadMoreSounds()}onSoundAdded(){let{player:e}=this,t=e.element.querySelectorAll("a.play:not(.initialized)");t.length>0&&e.loadSounds(t)}setUIState(e){"playing"===e?(this.element.classList.add("loading"),this.element.classList.add("playing"),this.element.classList.remove("paused")):"paused"===e&&(this.element.classList.add("paused"),this.element.classList.remove("playing"))}currentTrackLink(e){let t=this.element.querySelector("a.play.current");return null===t&&(!0===e?t=this.element.querySelector("a.play:first-child"):"true"===this.element.dataset.shuffle&&(t=this.seekTrack())),t}seekTrack(e){let t,s;if(typeof e>"u"&&(e="prev"),"true"===this.element.dataset.shuffle)s=this.element.querySelectorAll("li:not(.current) a.play"),t=s[Math.floor(Math.random()*s.length)];else{let a,r,o=this.currentTrackLink();o&&(a=o.closest("li")),a&&(r="next"===e?a.nextElementSibling:a.previousElementSibling,r&&(t=r.querySelector("a.play"))),void 0===t&&"true"===this.element.dataset.loopPlaylist&&(s=this.element.querySelectorAll("a.play"),"prev"===e?t=s[s.length-1]:[t]=s)}let a=new CustomEvent(`loadMore.${this.NAMESPACE}`,{bubbles:!0,cancelable:!0,detail:{el:this.element,type:"loadMore.media"}});return this.element.dispatchEvent(a),t}previousTrack(){return this.seekTrack("prev")}nextTrack(){return this.seekTrack("next")}currentSound(){let e=this.element.querySelector("a.play.current");return null===e?null:e.playable}seekTo(e){let t=this.currentSound();if(null===t)return;let{duration:s}=t;t.bytesTotal>t.bytesLoaded&&(s=t.durationEstimate),t.setPosition(e*s)}loadUnitializedSounds(){this.loadSounds(this.element.querySelectorAll("a.play:not(.initialized)"))}loadSounds(e){for(let t=0;t<e.length;t+=1)e[t].classList.add("initialized"),new h(e[t],this.element)}updateArtistToPlayer(e){this.element.querySelectorAll("[data-target=artist]").forEach((t=>{e?(t.classList.remove("empty"),t.innerHTML=`<span>${E(e)}</span>`):(t.classList.add("empty"),t.innerHTML="")}))}getTrackContainer(e){return e.closest("li")}copyActionsToPlayer(e,t,s){let a=this.element.querySelector(s);if(a){let s=this.getTrackContainer(e).querySelector(t);for(;a.firstChild;)a.removeChild(a.firstChild);s&&a.appendChild(s.cloneNode(!0))}}copyShareActionToPlayer(e){this.copyActionsToPlayer(e,".track-social .zoogle-share",".player .actions .share-contents .links")}copyBuyButtonToPlayer(e){this.copyActionsToPlayer(e,".track-action",".player .actions .action"),this.copyActionsToPlayer(e,".track-action",".swmp-header .action");let t=this.element.querySelector(".swmp-header .actions");t&&t.classList.toggle("hide",""===t.innerText.replace(/\s/g,""))}copyArtworkToPlayer(e){let t=this.element,s=t.querySelector("[data-target=album-artwork]");if(s){let a=t.querySelector("[data-target=album-artwork-background]"),r="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",o=!1,i=this.getTrackContainer(e).dataset.albumImageUrl;if(i&&""!==i)o=!0,r=i,s.setAttribute("src",i);else{let e=document.querySelector(".page-photo-background");e&&(r=getComputedStyle(e).backgroundImage.replace(/url\("(.*)"\)/,"$1"))}a.setAttribute("style",`background-image: url(${r})`),t.querySelector(".album-artwork").classList.toggle("placeholder",!o)}}updateProgress(e,t){let s=M(e),a=this.element.querySelectorAll(".swmp-header .progress .cur, .player .progress .cur, .player .time-actions-wrapper .cur, .current .progress .cur"),r=this.element.querySelectorAll(".swmp-header .progress .position, .player .progress .position, .current .progress .position");this.element.classList.remove("loading"),a.forEach((e=>{e.innerHTML=s})),r.forEach((e=>{e.style.width=`${Math.min(100,t)}%`}))}updateTrackDisplay(e){let t=this.element,s=e.dataset;s.title||(s.title=e.innerHTML),null!==t.querySelector(".player")&&(t.querySelectorAll("[data-target=player-title]").forEach((e=>{e.innerHTML=s.title,this.applyMarquee(e)})),t.querySelectorAll(".player .progress .duration, .player .time-actions-wrapper .duration, .swmp-header .progress .duration").forEach((e=>{e.innerHTML=s.duration})),t.querySelectorAll(".progress .cur, .time-actions-wrapper .cur").forEach((e=>{e.innerHTML="0:00"})),this.updateArtistToPlayer(s.artist),this.copyBuyButtonToPlayer(e),this.copyArtworkToPlayer(e),this.copyShareActionToPlayer(e))}applyMarquee(e){e.classList.contains("marquee")&&d(e)}resizeApplyMarquee(){this.element.querySelectorAll("[data-target=player-title]").forEach((e=>{d(e)}))}setupDeferredPlaylist(){let e=this.wrapper.querySelector(".track-list");if(!e)return;let{loadMore:t}=e.dataset;if(!0!==t&&"true"!==t)return;let s=this.element.querySelectorAll(`${this.MUSIC_FEATURE_INTERSECTION_CLASS}:not(.${this.MUSIC_FEATURE_OBSERVED_CLASS})`);if(typeof IntersectionObserver>"u"||!0===IntersectionObserver.polyfill)this.loadMoreSounds(!0);else{this.observer=new IntersectionObserver((e=>this.onPlaylistIntersection(e)),this.PLAYLIST_OBSERVER_CONFIG);for(let e=0;e<s.length;e+=1)s[e].classList.add(this.MUSIC_FEATURE_OBSERVED_CLASS),this.observer.observe(s[e])}}onPlaylistIntersection(e){for(let t=0;t<e.length;t+=1){let s=e[t];s.isIntersecting&&(this.observer.unobserve(s.target),s.target.classList.remove(this.MUSIC_FEATURE_OBSERVED_CLASS),this.loadMoreSounds())}}loadMoreSounds(e){let{loadMore:t}=this.wrapper.querySelector(".track-list").dataset;if(void 0===t)return;let{offset:s}=this.wrapper.querySelector(".track-list").dataset,{albumId:a}=this.wrapper.querySelector("[data-album-id]").dataset,r=`/go/albums/${a}/tracks?offset=${s}`;void 0!==this.featureId&&(r=`${r}&music_feature_id=${this.featureId}`);let o=this.element.querySelector(".track-list"),i=new XMLHttpRequest;if(!0!==t&&"true"!==t)return;!0===e&&(r+="&amount=1000");let l=this;i.open("GET",r,!0),i.onload=()=>{if(i.status>=200&&i.status<400){let e=i.responseText,t=A(e);o.dataset.offset=t.dataset.offset,o.dataset.loadMore=t.dataset.loadMore;let s=t.querySelectorAll("li");for(let e=0;e<s.length;e+=1)o.appendChild(s[e]);document.dispatchEvent(new CustomEvent("pageLoad")),l.loadSounds(o.querySelectorAll("a.play:not(.initialized)")),l.setupDeferredPlaylist()}},i.send()}pause(){let{player:e}=this,t=e.currentSound();t&&t.pause(),e.setUIState("paused")}updatePosition(e){sessionStorage.setItem(this.SESSION_KEY,this.featureId),sessionStorage.setItem(`${this.SESSION_KEY}_position`,e.position),sessionStorage.setItem(`${this.SESSION_KEY}_url`,e.url)}};export{L as a,T as b,g as c,P as d};